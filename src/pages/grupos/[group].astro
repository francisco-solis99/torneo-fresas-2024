---
// export const prerender = true;
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/Container.astro";
import Match from "@/components/Match.astro";
import { db } from "@/lib/db";

export function getStaticPaths() {
  return [
    { params: { group: "A" } },
    { params: { group: "B" } },
    { params: { group: "C" } },
    { params: { group: "D" } },
    { params: { group: "E" } },
    { params: { group: "F" } },
  ];
}

const groupsColors: Record<string, string> = {
  A: "bg-red-950/90",
  B: "bg-yellow-950/90",
  C: "bg-emerald-950/90",
  D: "bg-cyan-950/90",
  E: "bg-rose-950/90",
  F: "bg-amber-950/90",
  G: "bg-teal-950/90",
  H: "bg-violet-950/90",
};

const { group } = Astro.params;

const matchesByGroup = db
  .prepare(
    `
    SELECT m.id AS match_id, g.name AS group_name,
    d1.player1 AS player1_duo1,
    d1.player2 AS player2_duo1,
    d2.player1 AS player1_duo2,
    d2.player2 AS player2_duo2,
    m.points_d1,
    m.points_d2,
    p.name AS phase_name
    FROM matches m
    INNER JOIN duos d1 ON m.duo1_id = d1.id
    INNER JOIN duos d2 ON m.duo2_id = d2.id
    INNER JOIN groups g ON d1.group_id = g.id
    INNER JOIN phases p ON m.phase_id = p.id
    WHERE g.name = ?;
`
  )
  .all(group);
---

<Layout title="Torneo de las Fresas 2024" description="Torneo de las Fresas">
  <div>
    <header
      class="grid-pattern-background relative py-12"
      style="--_num-lines: 5vmin; --_heigh-pattern: 40vh;"
    >
      <div
        class={`absolute left-1/2 top-1/2 h-80 w-full -translate-x-1/2 -translate-y-3/4 rounded-full opacity-70 blur-[60px] ${groupsColors[group]} -z-10`}
      >
      </div>
      <h1
        class="-skew-y-6 font-audioWide px-5 text-5xl md:text-6xl text-center"
        transition:name=`group-name-${group}`
      >
        Grupo <br />
        <span class="inline-flex mt-1.5 text-7xl md:text-8xl">{group}</span>
      </h1>
    </header>
  </div>
  <Container class:list={["max-w-7xl"]}>
    <main class="px-3 sm:px-7 mt:px-10 mt-14 mb-32 lg:mt-20 lg:mb-40">
      <div
        class="grid sm:grid-cols-2 lg:grid-cols-3 gap-x-8 md:gap-x-12 gap-y-12"
      >
        {
          matchesByGroup.map((match: any) => {
            return (
              <Match
                player1Duo1={match.player1_duo1}
                player2Duo1={match.player2_duo1}
                player1Duo2={match.player1_duo2}
                player2Duo2={match.player2_duo2}
                pointsDuo1={match.points_d1}
                pointsDuo2={match.points_d2}
              />
            );
          })
        }
      </div>
    </main>
  </Container>
</Layout>
